<div class="truck-form-container">
  <mat-card class="form-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>directions_car</mat-icon>
        {{ isEditMode ? 'Editar Caminhão' : 'Novo Caminhão' }}
      </mat-card-title>
      <mat-card-subtitle>
        {{ isEditMode ? 'Atualize as informações do caminhão' : 'Cadastre um novo caminhão na frota' }}
      </mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <!-- Loading State -->
      <div *ngIf="loading && isEditMode" class="loading-container">
        <mat-spinner diameter="40"></mat-spinner>
        <p>Carregando dados do caminhão...</p>
      </div>

      <!-- Form -->
      <form [formGroup]="truckForm" (ngSubmit)="onSubmit()" class="truck-form" *ngIf="!loading || !isEditMode">
        
        <!-- Placa -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Placa do Caminhão</mat-label>
          <input 
            matInput 
            formControlName="licensePlate" 
            placeholder="ABC1234"
            maxlength="7"
            [disabled]="isEditMode">
          <mat-icon matSuffix>confirmation_number</mat-icon>
          <mat-hint>Formato: 3 letras + 4 números (ex: ABC1234)</mat-hint>
          <mat-error *ngIf="truckForm.get('licensePlate')?.invalid && truckForm.get('licensePlate')?.touched">
            {{ getErrorMessage('licensePlate') }}
          </mat-error>
        </mat-form-field>

        <!-- Modelo -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Modelo</mat-label>
          <input 
            matInput 
            formControlName="model" 
            placeholder="Ex: Volvo FH 540"
            maxlength="50">
          <mat-icon matSuffix>directions_car</mat-icon>
          <mat-error *ngIf="truckForm.get('model')?.invalid && truckForm.get('model')?.touched">
            {{ getErrorMessage('model') }}
          </mat-error>
        </mat-form-field>

        <!-- Ano -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Ano</mat-label>
          <input 
            matInput 
            type="number" 
            formControlName="year" 
            placeholder="2024"
            min="1900"
            [max]="getCurrentYear() + 1">
          <mat-icon matSuffix>calendar_today</mat-icon>
          <mat-error *ngIf="truckForm.get('year')?.invalid && truckForm.get('year')?.touched">
            {{ getErrorMessage('year') }}
          </mat-error>
        </mat-form-field>

        <!-- Status -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Status</mat-label>
          <mat-select formControlName="status">
            <mat-option value="ativo">
              <mat-icon>check_circle</mat-icon>
              Ativo
            </mat-option>
            <mat-option value="inativo">
              <mat-icon>cancel</mat-icon>
              Inativo
            </mat-option>
          </mat-select>
          <mat-icon matSuffix>toggle_on</mat-icon>
          <mat-error *ngIf="truckForm.get('status')?.invalid && truckForm.get('status')?.touched">
            {{ getErrorMessage('status') }}
          </mat-error>
        </mat-form-field>

        <!-- Action Buttons -->
        <div class="form-actions">
          <button 
            mat-button 
            type="button" 
            (click)="onCancel()"
            [disabled]="loading">
            <mat-icon>cancel</mat-icon>
            Cancelar
          </button>
          
          <button 
            mat-raised-button 
            color="primary" 
            type="submit"
            [disabled]="truckForm.invalid || loading">
            <mat-spinner *ngIf="loading" diameter="20" class="button-spinner"></mat-spinner>
            <mat-icon *ngIf="!loading">{{ isEditMode ? 'save' : 'add' }}</mat-icon>
            <span *ngIf="!loading">{{ isEditMode ? 'Atualizar' : 'Cadastrar' }}</span>
            <span *ngIf="loading">{{ isEditMode ? 'Atualizando...' : 'Cadastrando...' }}</span>
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</div>
