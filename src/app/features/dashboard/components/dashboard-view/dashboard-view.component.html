<div class="dashboard-container">
  <!-- Header -->
  <div class="dashboard-header">
    <h1>Dashboard - FrotaControl</h1>
    <button mat-raised-button color="primary" (click)="refreshData()" [disabled]="loading">
      <mat-icon>refresh</mat-icon>
      Atualizar
    </button>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <mat-spinner></mat-spinner>
    <p>Carregando dados do dashboard...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-container">
    <mat-icon color="warn">error</mat-icon>
    <p>{{ error }}</p>
    <button mat-raised-button color="primary" (click)="refreshData()">
      Tentar Novamente
    </button>
  </div>

  <!-- Dashboard Content -->
  <div class="dashboard-content" *ngIf="!loading && !error">
    
    <!-- Summary Cards -->
    <div class="summary-cards" *ngIf="dashboardSummary">
      <mat-card class="summary-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>directions_car</mat-icon>
            Total de Caminhões
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="card-value">{{ dashboardSummary.totalTrucks }}</div>
          <div class="card-subtitle">{{ dashboardSummary.activeTrucks }} ativos</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="summary-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>trending_up</mat-icon>
            Receita Total
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="card-value positive">{{ formatCurrency(dashboardSummary.totalRevenue) }}</div>
          <div class="card-subtitle">{{ dashboardSummary.totalEntries }} lançamentos</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="summary-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>trending_down</mat-icon>
            Despesas Totais
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="card-value negative">{{ formatCurrency(dashboardSummary.totalExpenses) }}</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="summary-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>account_balance</mat-icon>
            Lucro Líquido
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="card-value" [class]="getNetIncomeClass(dashboardSummary.netIncome)">
            {{ formatCurrency(dashboardSummary.netIncome) }}
          </div>
          <div class="card-subtitle">{{ formatNumber(dashboardSummary.profitMargin) }}% margem</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="summary-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>local_gas_station</mat-icon>
            Média Km/L
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="card-value">{{ formatNumber(dashboardSummary.averageFuelEfficiency) }}</div>
          <div class="card-subtitle">km por litro</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="summary-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>attach_money</mat-icon>
            Valor Médio
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="card-value">{{ formatCurrency(dashboardSummary.averageEntryValue) }}</div>
          <div class="card-subtitle">por lançamento</div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Trucks Performance Table -->
    <mat-card class="performance-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>assessment</mat-icon>
          Performance por Caminhão
          <span class="subtitle">(Últimos 30 dias)</span>
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="table-container" *ngIf="trucksPerformance.length > 0">
          <table class="performance-table">
            <thead>
              <tr>
                <th>Placa</th>
                <th>Modelo</th>
                <th>Receita</th>
                <th>Despesas</th>
                <th>Lucro Líquido</th>
                <th>Margem</th>
                <th>Km/L</th>
                <th>Lançamentos</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let truck of trucksPerformance">
                <td><mat-chip>{{ truck.licensePlate }}</mat-chip></td>
                <td>{{ truck.model }} ({{ truck.year }})</td>
                <td class="positive">{{ formatCurrency(truck.totalRevenue) }}</td>
                <td class="negative">{{ formatCurrency(truck.totalExpenses) }}</td>
                <td [class]="getNetIncomeClass(truck.netIncome)">
                  {{ formatCurrency(truck.netIncome) }}
                </td>
                <td>{{ formatNumber(truck.profitMargin) }}%</td>
                <td>{{ formatNumber(truck.fuelEfficiency) }}</td>
                <td>{{ truck.entryCount }}</td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <!-- Empty State -->
        <div class="empty-state" *ngIf="trucksPerformance.length === 0">
          <mat-icon>directions_car</mat-icon>
          <p>Nenhum dado de performance encontrado para os últimos 30 dias</p>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
